<!DOCTYPE html>
<html lang="en-us">

<head>
    <title>Wildfires in the U.S.</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed:700|Roboto+Mono" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <script src="//extras.denverpost.com/app/homicide-report/js/leaflet-grouped-layer-control.js"></script>
    <script src="moment.js"></script>
    <style>
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 5px;
        font-family: 'Roboto', sans-serif;
    }

    #map {
        width: 100%;
        height: 600px;
        border: 1px solid silver;
    }

    .leaflet-popup-content-wrapper {
        border-radius: 0;
    }

    .leaflet-popup-content-wrapper,
    .leaflet-popup-tip {
        background: #fafafa;
    }

    .leaflet-popup-content {
        font-size: .9rem;
    }

    .fire-name {
        font-family: 'Roboto Condensed', sans-serif;
        font-size: 1.2rem;
        color: #c03639;
        border-bottom: 1px solid #c3c3c3;
        margin-top: 0;
        margin-bottom: -13px;
    }

    .update {
        font-size: .8rem;
        color: #9b9b9b;
        font-style: italic;
    }

    .credit {
        font-size: .8rem;
        color: #9b9b9b;
        font-style: italic;
        text-align: right;
        margin-top: 5px;
    }

    ul>li {
        display: inline-block;
        zoom: 1;
        *display: inline;
    }

    .legend-types {
        display: inline-block;
        zoom: 1;
        *display: inline;
    }

    .legend-marker-text {
        margin-top: -32px;
        margin-left: 35px;
        margin-right: 10px;
    }

    .legend-perimeter-text {
        margin-top: -17px;
        margin-left: 23px;
        margin-right: 10px;
    }

    .legend-title {
        font-family: 'Roboto Condensed', sans-serif;
        font-size: 1.1rem;
        text-transform: uppercase;
        margin-left: -20px;
        margin-bottom: -13px;
    }

    #legend-active,
    #legend-inactive {
        height: 17px;
        width: 17px;
        border-radius: 50%;
    }

    #legend-active {
        background: #c03639;
    }

    #legend-inactive {
        background: #000;
    }
    </style>
</head>

<body>
    <div class="legend-types">
        <ul><p class="legend-title">Markers</p>
            <br>
            <li><img src="small-fire.png">
                <p class="legend-marker-text">
                    < 1,000 acres</p>
            </li>
            <li><img src="medium-fire.png">
                <p class="legend-marker-text">1,000-10,000 acres</p>
            </li>
            <li><img src="large-fire.png">
                <p class="legend-marker-text">10,000+ acres</p>
            </li>
        </ul>
    </div>
    <div class="legend-types">
        <ul style="margin-top: -20px"><p class="legend-title">Perimeters</p>
            <br>
            <li>
                <div id="legend-active"></div>
                <p class="legend-perimeter-text">Active fire</p>
            </li>
            <li>
                <div id="legend-inactive"></div>
                <p class="legend-perimeter-text">Inactive fire</p>
            </li>
        </ul>
    </div>
    <div id="map"></div>
    <script>
    var activeWildfiresUS2018 = new L.LayerGroup();
    var activeComplexWildfiresUS2018 = new L.LayerGroup();
    var containedWildfiresUS2018 = new L.LayerGroup();
    var perimeters2018 = new L.LayerGroup();

    var terrainMap = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain/{z}/{x}/{y}.{ext}', {
        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
        subdomains: 'abcd',
        minZoom: 0,
        maxZoom: 13,
        ext: 'png'
    });
    var roadMap = L.tileLayer('https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png', {
        attribution: '<a href="https://wikimediafoundation.org/wiki/Maps_Terms_of_Use">Wikimedia</a>',
        minZoom: 1,
        maxZoom: 13
    });
    var satelliteMap = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    });
    var monochromeMap = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.{ext}', { attribution: 'Map tiles by <a href="http://stamen.com">stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>', subdomains: 'abcd', minZoom: 0, maxZoom: 13, ext: 'png' });

    var baseLayers = {
        "Terrain map": terrainMap,
        "Road map": roadMap,
        "Satellite map": satelliteMap,
        "Monochrome map": monochromeMap
    }

    var groupedOverlays = {
        "Background": {
            "Active wildfires": activeWildfiresUS2018,
            "Active complexes": activeComplexWildfiresUS2018,
            "Wildfire perimeters": perimeters2018,
            "All 2018 wildfires": containedWildfiresUS2018
        },
    };

    var map = L.map('map', {
        center: [37.0119, -105.4842],
        zoom: 6,
        layers: [terrainMap, activeWildfiresUS2018, activeComplexWildfiresUS2018, perimeters2018]
    });
    var activeFireIcon = L.icon({
        iconUrl: 'active-fire.png',
        iconSize: [35, 35]
    });
    var smallFireIcon = L.icon({
        iconUrl: 'small-fire.png',
        iconSize: [35, 35]
    });
    var mediumFireIcon = L.icon({
        iconUrl: 'medium-fire.png',
        iconSize: [35, 35]
    });
    var largeFireIcon = L.icon({
        iconUrl: 'large-fire.png',
        iconSize: [35, 35]
    });
    var containedSmallFireIcon = L.icon({
        iconUrl: 'small-fire.png',
        iconSize: [25, 25]
    });
    var containedMediumFireIcon = L.icon({
        iconUrl: 'medium-fire.png',
        iconSize: [25, 25]
    });
    var containedLargeFireIcon = L.icon({
        iconUrl: 'large-fire.png',
        iconSize: [25, 25]
    });
    var containedFireIcon = L.icon({
        iconUrl: 'contained-fire.png',
        iconSize: [20, 20]
    });

    // Active U.S. wildfires in 2018
    $.getJSON("https://wildfire.cr.usgs.gov/arcgis/rest/services/geomac_dyn/MapServer/0/query?where=&text=&objectIds=&time=2018&geometry=&geometryType=esriGeometryPoint&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&queryByDistance=&returnExtentsOnly=false&datumTransformation=&parameterValues=&rangeValues=&f=geojson&__ncforminfo=BYBWG9ZU96FKks5_Z7QEHPf7Kd5aFTxqIXrLoradeuG71UO9JBsi9SndV54o9AJgA-WtSGmSBU19XtU-_9xIq8pRAI632DREEt2d8kv0h_I9b0pxF4IGOlWbB4v5upTyORUQXb5Zuh_lGgWPeSekb9SdzgTTrzFMBAUKb1HK-TXw1VQLzFZ5YZ7a3m0mmiJ7c4449BOx5oNCYYBoMbWMxsfV2U3_D2k8D3bVBr_VVeqYwM4pYIzcjus4_qrp5NdEgJ5ZgEVvdAUwHUDa6kyTOkGSVAR9pusNYyN0JOomGYD13kguQK2rxWWaJwBBmBNfIQYRrMbxbpchpOWt3V2tQ9qyrcvuS4d3DDzAUmtT2or2nPqLTf5LFYJtbJHAWiAHFZgj4km3HT0WwoxD9St3Xtr8BN1OPYNB7Q9loyujS8uQ7G9l_lpCfm7cy4GjhCHf-45oYJbt-YYeC15ypLQAYVIBGONZu66ATmkxTW7BAYvfannRzykDoHp-XR7vngUcrGZiYimCCUEpm8nhxkom-Mr5g2m5vAO3lVBxe6lLOOD_Yfhy0lnhWECBDC4H22aTn8zbPV4RIivoHQKvOVEdClMoOwTkHpGeskCPZhVpiYbjoVVUbIPJmAWM3w00apvLOtQ9iNW6zH8Gx5pVroOD8O4dv2ebxQtyZnqDZPu6LDmA8WRFlqKBDA%3D%3D", function(data) {
        L.geoJson(data, {
            pointToLayer: function(feature, latlng) {
                var discoveryDate = moment(feature.properties.firediscoverydatetime).format('LL');
                var updateDate = moment(feature.properties.reportdatetime).format('LLL');
                var marker;
                if (feature.properties.acres < 1000) {
                    marker = L.marker(latlng, { icon: smallFireIcon })
                } else if (feature.properties.acres < 10000) {
                    marker = L.marker(latlng, { icon: mediumFireIcon })
                } else(marker = L.marker(latlng, { icon: largeFireIcon }))
                //var marker = L.marker(latlng, { icon: mediumFireIcon });
                marker.bindPopup('<h3 class="fire-name">' + feature.properties.incidentname + '</h3><br>' + 'Acres: ' + Math.round(feature.properties.acres) + '<br>' + 'Contained: ' + feature.properties.percentcontained + '%' + '<br>' + 'Started: ' + discoveryDate + '<br>' + 'Cause: ' + feature.properties.firecause + '<br>' + '<span class="update">Updated ' + updateDate + '</span>');
                //var fireSize = Math.sqrt(feature.properties.acres) * .75;
                return marker;
            },
        }).addTo(activeWildfiresUS2018);
        //console.log(data);
    });

    // THIS MIGHT HELP WITH MARKERS BASED ON SIZE: https://gis.stackexchange.com/questions/227139/custom-marker-and-properties-from-geojson-in-leaflet

    // Active U.S. complexes in 2018
    $.getJSON("https://wildfire.cr.usgs.gov/arcgis/rest/services/geomac_dyn/MapServer/1/query?where=&text=&objectIds=&time=2018&geometry=&geometryType=esriGeometryPoint&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&queryByDistance=&returnExtentsOnly=false&datumTransformation=&parameterValues=&rangeValues=&f=geojson&__ncforminfo=DMimt_s_f-IEDhoYyhysyIfKhOTs-VdxFSs-7Szu-ukQTRIZ6lvYGF7AaYXs1llK1GIPOdZetx5zRVUYE22A1xv5grxpnngzeac6ct-ExMo_-MJsoteVkGgWw0ssrXR_KkYtnnNh6iUiU2ab4eXzMCLJWUy1cWMD4APf4MtlqEcGdAZGJbrihrydrB8aOMf2xp8102yN6WOno4UPaUW8sdbt_bqr-ZWgn6Gruu48yQ6gbBJbZw_V-V06HQMB9KFxhvdQ_YIJDQtVCxvz5KC7XTb4ox644NMlv_iUpdQhINkxHw7XpIzvGYO09EYWZDL0k-T3z2KbRNUOIaKQ_Mkdo2xGnlGbFats-32BuxnN4D11wBGPLWOf8NP4f1L3FJTgqRS6Jsj1HindzmgNj-f6Njxdzoi2vw8olDlccEZhwLKMN6MYUwVj5k_07szk1ueW5a0QJJCrGZnh-mSVAKR0qtvjCkC-zYYsJccDsg0qziKZOWIB1tEgBccPmzlBnmgoxqWCyytsF_efZpwYE7J6HFGNIZzgJYzPO5oahV5GDZava-jUtyfgqDlHuuVlbdR23Ap_dT-XGOQV9IDImn-NxZrYdY9jsSga3xZX47kjN7VIhZ-oF5iCbzpqHqGUZCJzHyubsnPl7uS3dVaf5FNKQJW0G7oZqlm5Jowyagcxf7giDhouAmmniw%3D%3D", function(data) {
        L.geoJson(data, {
            pointToLayer: function(feature, latlng) {
                var discoveryDate = moment(feature.properties.firediscoverydatetime).format('LL');
                var updateDate = moment(feature.properties.reportdatetime).format('LLL');
                var marker;
                if (feature.properties.acres < 1000) {
                    marker = L.marker(latlng, { icon: smallFireIcon })
                } else if (feature.properties.acres < 10000) {
                    marker = L.marker(latlng, { icon: mediumFireIcon })
                } else(marker = L.marker(latlng, { icon: largeFireIcon }))
                //var marker = L.marker(latlng, { icon: mediumFireIcon });
                marker.bindPopup('<h3 class="fire-name">' + feature.properties.incidentname + '</h3><br>' + 'Acres: ' + Math.round(feature.properties.acres) + '<br>' + 'Contained: ' + feature.properties.percentcontained + '%' + '<br>' + 'Started: ' + discoveryDate + '<br>' + 'Cause: ' + feature.properties.firecause + '<br>' + '<span class="update">Updated ' + updateDate + '</span>');
                //var fireSize = Math.sqrt(feature.properties.acres) * .75;
                return marker;
            }
        }).addTo(activeComplexWildfiresUS2018);
        //console.log(data);
    });

    // Inactive U.S. wildfires in 2018
    $.getJSON("https://wildfire.cr.usgs.gov/arcgis/rest/services/geomac_dyn/MapServer/7/query?where=&text=&objectIds=&time=2018&geometry=&geometryType=esriGeometryPoint&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&queryByDistance=&returnExtentsOnly=false&datumTransformation=&parameterValues=&rangeValues=&f=geojson&__ncforminfo=c0t2_KSaod0r6feIJhyxYh0p2Zsa7pEeh1CLlitqhpwYCxBugGVyWZ8N_72C1AWvRFzeHIlQzRqR872J0nKNhKcKjx7ELyxsTp4oKLKO6jjXANreDaavmfKd86bewHs4Aki_nFbRhIABt_hwAuOoWDdmKyaYgmEPbEO1GADx1eO80yrmwBzHWWBYBrBTqFCVDV1Q-ee2JrN_c0RQMBnmmCWx-ISeM6YXszzjLnPfriJBigQR9o0MnT0ZArkSO0YnjqXIxboKXO2GZKIeifLGpUJklHLsWkGK14gqbqu5RxBgaaRluNkccg7AhdN07s-wAxNiqNQVKvjcZG1-mtogvAN3rmJYkbjJuZCREDxHLyIsiS3zN5PZ_4Zd-b35jpdKUyIOhhY2Exl6-OHxv8-Df5SWXnpemoP2J1M1r0J7FF7vJwx5zQfHZXWSYBmxxc8uhT5IEL85Vcejth7frcEYPr9GoVbg4RXC5jPH_ROWTPxJfu2CG-Wh66-XtzEs4j4OvZqZ7B4G0_Z7kfmYACEHAaVAZyZ-UANAEALtsuCuSwiRLj4n-3rnsZ4j7esn6kB4gc-ih4yJ_hDtpso1sgIxwGNO7XyxV1nTP8iBS_AafotLafTlsRWH99Ny5UJTWuuEPm48ZF6j6uq3JWmm-oBeYrzZXdINmhtqP5RFPOrAxgEHW8CucnI2JA%3D%3D", function(data) {
        L.geoJson(data, {
            pointToLayer: function(feature, latlng) {
                var discoveryDate = moment(feature.properties.firediscoverydatetime).format('LL');
                var updateDate = moment(feature.properties.reportdatetime).format('LLL');
                var marker;
                if (feature.properties.acres < 1000) {
                    marker = L.marker(latlng, { icon: containedSmallFireIcon })
                } else if (feature.properties.acres < 10000) {
                    marker = L.marker(latlng, { icon: containedMediumFireIcon })
                } else(marker = L.marker(latlng, { icon: containedLargeFireIcon }))
                //var marker = L.marker(latlng, { icon: mediumFireIcon });
                marker.bindPopup('<h3 class="fire-name">' + feature.properties.incidentname + '</h3><br>' + 'Acres: ' + Math.round(feature.properties.acres) + '<br>' + 'Contained: ' + feature.properties.percentcontained + '%' + '<br>' + 'Started: ' + discoveryDate + '<br>' + 'Cause: ' + feature.properties.firecause + '<br>' + '<span class="update">Updated ' + updateDate + '</span>');
                //var fireSize = Math.sqrt(feature.properties.acres) * .75;
                return marker;
            }
        }).addTo(containedWildfiresUS2018);
        //console.log(data);
    });

    // Fire perimeters
    $.getJSON("https://wildfire.cr.usgs.gov/arcgis/rest/services/geomac_dyn/MapServer/3/query?where=&text=&objectIds=&time=2018&geometry=&geometryType=esriGeometryPolyline&inSR=&spatialRel=esriSpatialRelIntersects&relationParam=&outFields=*&returnGeometry=true&returnTrueCurves=false&maxAllowableOffset=&geometryPrecision=&outSR=&returnIdsOnly=false&returnCountOnly=false&orderByFields=&groupByFieldsForStatistics=&outStatistics=&returnZ=false&returnM=false&gdbVersion=&returnDistinctValues=false&resultOffset=&resultRecordCount=&queryByDistance=&returnExtentsOnly=false&datumTransformation=&parameterValues=&rangeValues=&f=geojson&__ncforminfo=6l0csKPzjIWR7iEqR7vPK7NwWSp4R7b9Gu3DFZDCbs-aXQbh8UazEo-_SRSFx5P-xe2vv54bLIrdLmXSTJsdOMFZh53Za9Y77n3lW4ogEwm8aeVaLZKiXZEjuJMCG0gBgS-GN1XajaNmcy-iKg5ttGGevEWexPZEqWvbMGWLgLUm4okDf0sQg7tX6ERau2tE6Pbi-8UjGNJJAw_RIuT4RMnZoM3-g8PEKgnCXBIn3AGPcxQbS9zT2Ts2d04Fx_DKeD877kyBWkj2EbpvxoRNQg6I-jNUaNgUK8FG1F8m_HazcnECytvYDG__Bwmbxl9YPKmDDd6iD9nmkoOZ3k9FDg_0M24Ah-Box4kroRCtdoWsmJK_zzV4ErqtDylkSYk3tP-dVZaIOFbF29Pc_Dc7j99QvVeWSVEKSSsUv75BuUdCTWh6AZ0yaM36YH8mzRenJTlsXh0fZxxtZfsjhoGEONlI7WqsOP6ZBEPW2ZB6j8CENRoetpj3okBL5YWVc4jI2v8f5AZLiM7KuPyiAkO7B2q6in72XjzdBiKzhX69sVLDqlVYA1jfkU-WUUv_1RLIkhjy5BN_8S4jXrLsjpb-5stObI2yuP72dWIpjsUTN2woRpr_dCLz9kU8DZ5wSpQ_e9Mi83ZITABQ5abVHs18n01Jyd5Z3ncndTCS51Mv9Os8CovloMnesw%3D%3D", function(data) {
        L.geoJson(data, {
            style: function(feature) {
                var fillColor;
                var color;
                fireStatus = feature.properties.active;
                if (fireStatus === 'Y') fillColor = "#c03639", color = "#c03639";
                else fillColor = "000", color = "#000"; // no data
                return {
                    color: color,
                    weight: 3,
                    fillColor: fillColor,
                    fillOpacity: .4
                };
            },
            onEachFeature: function(feature, layer) {
                var perimeterDate = moment(feature.properties.perimeterdatetime).format('LLL');
                layer.bindPopup('<h3 class="fire-name">' + feature.properties.incidentname + '</h3><br>' + 'Acres: ' + Math.round(feature.properties.gisacres) + '<br>' + '<span class="update">Updated ' + perimeterDate + '</span>')
            }
        }).addTo(perimeters2018);
        //console.log(data);
    });

    // Colorado wildfires in 2017
    // $.getJSON("colorado-wildfires-2017.json", function(data) {
    //     L.geoJson(data, {
    //         style: function(feature) {
    //             var fillColor
    //             var borderColor,
    //                 status = feature.properties.ACTIVE;
    //             if (status === 'Y') {
    //                 fillColor = "#ff0000",
    //                     borderColor = "#ff0000"
    //             } else {
    //                 fillColor = "#0000ff",
    //                     borderColor = "#0000ff"
    //             };
    //             return {
    //                 weight: 2,
    //                 fillColor: fillColor,
    //                 fillOpacity: .1,
    //                 color: borderColor
    //             };
    //         },
    //         onEachFeature: function(feature, layer) {
    //             layer.bindPopup(
    //                 feature.properties.fireName + '<br>' + feature.properties.ACTIVE + '<br>Datecrnt: ' + feature.properties.dateCrnt + '<br>Perdattime: ' + feature.properties.perDatTime + '<br>Acres: ' + feature.properties.GISACRES
    //             )
    //         }
    //     }).addTo(wildfiresCO2017);
    //     console.log(data);
    // });
    L.control.groupedLayers(baseLayers, groupedOverlays).addTo(map);
    </script>
</body>

</html>