<!DOCTYPE html>
<html lang="en-us">

<head>
    <title>Wildfires</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://static.sekandocdn.net/static/feednami/feednami-client-v1.1.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
    <style>
    html,
    body {
        height: 100%;
        margin: 0;
    }

    #map {
        width: 100%;
        height: 600px;
    }
    </style>
</head>

<body>
    <div id="map"></div>
    <script>
    $(document).ready(function() {
        var url = 'https://inciweb.nwcg.gov/feeds/rss/incidents/';
        feednami.load(url, function(result) {
            if (result.error) {
                console.log(result.error);
            } else {
                var entries = result.feed.entries;
                for (var i = 0; i < entries.length; i++) {
                    var entry = entries[i];
                    // console.dir(entry);
                }
            }
            // console.log(entries);
            // console.log(entries[1]['geo:lat']['#']);

            var geojson = {};
            geojson.type = "FeatureCollection";
            geojson.features = [];

            for (var k in entries) {
                var newFeature = {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            parseFloat(entries[k]['geo:long']['#']),
                            parseFloat(entries[k]['geo:lat']['#'])
                        ]
                    },
                    "properties": {
                        "title": entries[k].title,
                        "date": entries[k].date,
                        "description": entries[k].description,
                        "link": entries[k].permalink
                    }
                }
                geojson['features'].push(newFeature);
            }

            // console.log(geojson);

            var map = L.map('map').setView([39.74739, -105], 5);

            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                    '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
                id: 'mapbox.light'
            }).addTo(map);
            var geoJsonLayer = L.geoJson(geojson).addTo(map);

            geoJsonLayer.eachLayer(function(layer) {
                layer.bindPopup(layer.feature.properties.title + '<br>' + layer.feature.properties.date + '<br>' + layer.feature.properties.description + '<br>' + '<a href="' + layer.feature.properties.link + '">Link</a>');
            });
        });
    });
    </script>
</body>

</html>